<mat-form-field style="width: 30%" appearance="outline">
  <input
    type="text"
    placeholder="Search"
    matInput
    [formControl]="searchControl"
    [matAutocomplete]="auto"
  />
  <mat-autocomplete #auto="matAutocomplete">
    @for (item of filteredOptions ?? []; track item.id) {}
  </mat-autocomplete>
</mat-form-field>

<table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
  <!-- Select All Checkbox -->
  <ng-container matColumnDef="select">
    <th mat-header-cell *matHeaderCellDef>
      <mat-checkbox
        [checked]="isAllSelected()"
        (change)="toggleSelectAll($event.checked)"
      >
      </mat-checkbox>
    </th>
    <td mat-cell *matCellDef="let element">
      <mat-checkbox
        [checked]="isSelected(element)"
        (change)="toggleSelection(element)"
      >
      </mat-checkbox>
    </td>
  </ng-container>

  <!-- ID Column -->
  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef>ID</th>
    <td mat-cell *matCellDef="let element">
      <a class="link" (click)="idClick(element.id)">{{ element.id }}</a>
    </td>
  </ng-container>

  <!-- Updated By Column -->
  <ng-container matColumnDef="user">
    <th mat-header-cell *matHeaderCellDef>UpdatedBy</th>
    <td mat-cell *matCellDef="let element">
      <div style="display: flex; gap: 5px; align-items: center">
        <div [userBadge]="element.updatedBy" [size]="24"></div>
        {{ element.updatedBy.name }}
      </div>
    </td>
  </ng-container>

  <!-- Updated At Column -->
  <ng-container matColumnDef="date">
    <th mat-header-cell *matHeaderCellDef>UpdatedAt</th>
    <td mat-cell *matCellDef="let element">
      <div [formatDate]="element.updatedAt" format="dd.MM.yyyy HH:mm"></div>
    </td>
  </ng-container>

  @for (field of schema?.fields || []; let idx = $index; track idx) {
    <ng-container [matColumnDef]="'custom' + field.name">
      <th mat-header-cell *matHeaderCellDef>{{ field.name }}</th>
      <td mat-cell *matCellDef="let element">
        {{ readFieldValue(field, element) }}
      </td>
    </ng-container>
  }

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>

<mat-paginator [pageSize]="10"></mat-paginator>
