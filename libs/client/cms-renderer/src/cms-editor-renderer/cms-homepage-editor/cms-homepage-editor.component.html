@for (field of fields(); track field) {
  @if (field.type === 'content') {
    <div class="editor">
      <div
        cdkDropList
        [cdkDropListData]="sections"
        (cdkDropListDropped)="dropSection($event)"
        [style.width]="'100%'"
      >
        @for (section of sections; track section.id) {
          <div class="section" cdkDrag>
            <div class="control">
              <span class="id">#{{ section.id }}</span>
              <div class="toolbar">
                <mat-icon cdkDragHandle>open_with</mat-icon>
                <mat-icon>settings</mat-icon>
                <mat-icon (click)="deleteSection(section)"
                  >delete_forever</mat-icon
                >
              </div>
            </div>

            @if (section.rows.length > 0) {
              <div
                cdkDropList
                [cdkDropListData]="section.rows"
                [cdkDropListConnectedTo]="getSectionDropListIds()"
                [id]="'section-rows-' + section.id"
                (cdkDropListDropped)="dropRow($event, section)"
                [style.width]="'100%'"
              >
                @for (row of section.rows; track row.id) {
                  <div class="row" cdkDrag>
                    <div class="control">
                      <span class="id">#{{ row.id }}</span>
                      <div class="toolbar">
                        <mat-icon cdkDragHandle>open_with</mat-icon>
                        <mat-icon (click)="editRow(section, row)"
                          >settings</mat-icon
                        >
                        <mat-icon (click)="deleteRow(row, section)"
                          >delete_forever</mat-icon
                        >
                      </div>
                    </div>
                    <div
                      class="content"
                      [style.gridTemplateColumns]="row.layout.cssGrid"
                    >
                      @for (column of row.columns; track column.id) {
                        <div
                          class="column"
                          cdkDropList
                          [cdkDropListData]="column.components"
                          [cdkDropListConnectedTo]="getAllColumnDropListIds()"
                          [id]="'column-' + column.id"
                          (cdkDropListDropped)="dropComponent($event, row)"
                        >
                          @for (component of column.components; track $index) {
                            <div class="component" cdkDrag>
                              <div class="control">
                                <span class="id">#{{ component.id }}</span>
                                <div class="toolbar">
                                  <mat-icon cdkDragHandle>open_with</mat-icon>
                                  <mat-icon
                                    (click)="
                                      editComponent(
                                        section,
                                        row,
                                        column,
                                        component
                                      )
                                    "
                                    >settings</mat-icon
                                  >
                                  <mat-icon
                                    (click)="
                                      deleteComponent(
                                        section,
                                        row,
                                        column,
                                        component
                                      )
                                    "
                                    >delete_forever</mat-icon
                                  >
                                </div>
                              </div>
                              <span class="content">
                                @switch (component.type) {
                                  @case ('text') {
                                    <mat-icon>text_fields</mat-icon>
                                  }
                                  @case ('button') {
                                    <mat-icon>crop_7_5</mat-icon>
                                  }
                                  @case ('image') {
                                    <mat-icon>crop_original</mat-icon>
                                  }
                                  @case ('video') {
                                    <mat-icon>ondemand_video</mat-icon>
                                  }
                                  @case ('carousel') {
                                    <mat-icon>view_carousel</mat-icon>
                                  }
                                  @case ('map') {
                                    <mat-icon>map</mat-icon>
                                  }
                                  @case ('galery') {
                                    <mat-icon>view_module</mat-icon>
                                  }
                                  @case ('form') {
                                    <mat-icon>email</mat-icon>
                                  }
                                }
                                {{ component.type | uppercase }}
                              </span>
                            </div>
                          }

                          <button
                            mat-mini-fab
                            matTooltip="Add a Component"
                            style="
                              background-color: grey;
                              color: white;
                              transform: scale(0.7);
                            "
                            [matMenuTriggerFor]="selectComponent"
                            class="addBtn"
                          >
                            <mat-icon>add</mat-icon>
                          </button>
                          <mat-menu
                            #selectComponent="matMenu"
                            class="component-selection"
                          >
                            <button
                              mat-menu-item
                              (click)="addComponentToColumn(column, 'text')"
                              matTooltip="Formated Text"
                            >
                              <mat-icon>text_fields</mat-icon>
                              <span>Text</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="addComponentToColumn(column, 'button')"
                              matTooltip="Single Button"
                            >
                              <mat-icon>crop_7_5</mat-icon>
                              <span>Button</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="addComponentToColumn(column, 'image')"
                              matTooltip="Single Image"
                            >
                              <mat-icon>crop_original</mat-icon>
                              <span>Image</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="addComponentToColumn(column, 'video')"
                              matTooltip="Not implemented"
                              [disabled]="true"
                            >
                              <mat-icon>ondemand_video</mat-icon>
                              <span>Video</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="addComponentToColumn(column, 'carousel')"
                              matTooltip="Not implemented"
                              [disabled]="true"
                            >
                              <mat-icon>view_carousel</mat-icon>
                              <span>Carousel</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="addComponentToColumn(column, 'map')"
                              matTooltip="A Map with Marker"
                            >
                              <mat-icon>map</mat-icon>
                              <span>Map</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="addComponentToColumn(column, 'galery')"
                              matTooltip="Multiple images"
                            >
                              <mat-icon>view_module</mat-icon>
                              <span>Galery</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="addComponentToColumn(column, 'form')"
                              matTooltip="Not implemented"
                              [disabled]="true"
                            >
                              <mat-icon>email</mat-icon>
                              <span>Form</span>
                            </button>
                          </mat-menu>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>
            }
            <button
              mat-mini-fab
              matTooltip="Add a Row"
              (click)="addRow(section)"
              class="addBtn"
              style="
                background-color: DarkTurquoise;
                color: white;
                transform: scale(0.7);
              "
            >
              <mat-icon>add</mat-icon>
            </button>
          </div>
        }
        <button
          mat-mini-fab
          matTooltip="Add a Section"
          class="addBtn"
          (click)="addSection()"
          style="background-color: purple; color: white; transform: scale(0.7)"
        >
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>
  } @else {
    <lib-cms-form-field
      [field]="field"
      [form]="form"
      [languages]="project.settings.languages"
      [project]="project"
    />
  }
}
